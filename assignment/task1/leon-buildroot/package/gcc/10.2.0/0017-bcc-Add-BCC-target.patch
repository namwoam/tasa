From 3961b2d054eb9c983f9a810565fadf69d36ca48d Mon Sep 17 00:00:00 2001
From: Martin Aberg <maberg@gaisler.com>
Date: Fri, 6 Oct 2017 19:08:18 +0200
Subject: [PATCH 17/50] bcc: Add BCC target

---
 gcc/config.gcc           |   5 ++
 gcc/config/sparc/bcc.h   |  63 ++++++++++++++++++++++
 gcc/config/sparc/bcc.opt |  12 +++++
 gcc/config/sparc/t-bcc   | 114 +++++++++++++++++++++++++++++++++++++++
 4 files changed, 194 insertions(+)
 create mode 100644 gcc/config/sparc/bcc.h
 create mode 100644 gcc/config/sparc/bcc.opt
 create mode 100644 gcc/config/sparc/t-bcc

diff --git a/gcc/config.gcc b/gcc/config.gcc
index 8641b45662e..e250307083d 100644
--- a/gcc/config.gcc
+++ b/gcc/config.gcc
@@ -3273,6 +3273,11 @@ sh-wrs-vxworks)
 sparc-*-elf*)
 	tm_file="${tm_file} dbxelf.h elfos.h newlib-stdint.h sparc/sysv4.h sparc/sp-elf.h"
 	case ${target} in
+	    sparc-gaisler*)
+		tmake_file="sparc/t-sparc sparc/t-bcc"
+		tm_file="${tm_file} sparc/bcc.h"
+		extra_options="${extra_options} sparc/bcc.opt"
+		;;
 	    *-leon-*)
 		tmake_file="sparc/t-sparc sparc/t-leon"
 		;;
diff --git a/gcc/config/sparc/bcc.h b/gcc/config/sparc/bcc.h
new file mode 100644
index 00000000000..f12ad851c50
--- /dev/null
+++ b/gcc/config/sparc/bcc.h
@@ -0,0 +1,63 @@
+/* Definitions for LEON running on Cobham Gaisler BCC toolchain
+   Copyright (C) 2016 Free Software Foundation, Inc.
+   Contributed by Martin Aberg (maberg@gaisler.com).
+
+This file is part of GNU CC.
+
+GNU CC is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2, or (at your option)
+any later version.
+
+GNU CC is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with GNU CC; see the file COPYING.  If not, write to
+the Free Software Foundation, 59 Temple Place - Suite 330,
+Boston, MA 02111-1307, USA.  */
+
+#undef CPP_SUBTARGET_SPEC
+#define CPP_SUBTARGET_SPEC \
+" \
+%{qnano: -isystem %R/include/newlib-nano} \
+"
+
+/* Allow user to specify a BSP not in the default location. */
+#undef DRIVER_SELF_SPECS
+#define DRIVER_SELF_SPECS \
+" \
+%{!B: \
+  %{qbsp=*:-B %R/bsp/%*} \
+  %{!qbsp*:-B %R/bsp/leon3} \
+} \
+"
+
+#undef STARTFILE_SPEC
+#define STARTFILE_SPEC \
+" \
+%{!qsvt: trap_table_mvt.S.o%s} \
+%{qsvt: trap_table_svt.S.o%s} \
+crt0.S.o%s crti.o%s crtbegin.o%s \
+"
+
+#undef LIB_SPEC
+#define LIB_SPEC \
+" \
+--start-group \
+-lbcc \
+%{!qnano: -lc} \
+%{qnano: -lc_nano} \
+--end-group \
+"
+
+/* Use the default */
+#undef LINK_GCC_C_SEQUENCE_SPEC
+#define LINK_GCC_C_SEQUENCE_SPEC \
+" \
+%{!T*: -T linkcmds%s} \
+%G %L %G \
+"
+
diff --git a/gcc/config/sparc/bcc.opt b/gcc/config/sparc/bcc.opt
new file mode 100644
index 00000000000..67ba19cd7ec
--- /dev/null
+++ b/gcc/config/sparc/bcc.opt
@@ -0,0 +1,12 @@
+qbsp=
+Driver
+Select BSP
+
+qnano
+Driver
+Enable libc-nano
+
+qsvt
+Driver
+Enable single vector trapping
+
diff --git a/gcc/config/sparc/t-bcc b/gcc/config/sparc/t-bcc
new file mode 100644
index 00000000000..6c011058e0e
--- /dev/null
+++ b/gcc/config/sparc/t-bcc
@@ -0,0 +1,114 @@
+# Copyright (C) 2012-2014 Free Software Foundation, Inc.
+#
+# This file is part of GCC.
+#
+# GCC is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 3, or (at your option)
+# any later version.
+#
+# GCC is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with GCC; see the file COPYING3.  If not see
+# <http://www.gnu.org/licenses/>.
+
+# Multilibs for BCC2
+MULTILIB_OPTIONS         =
+MULTILIB_DIRNAMES        =
+
+MULTILIB_OPTIONS        += mcpu=leon/mcpu=leon3/mcpu=leon3v7
+MULTILIB_DIRNAMES       += leon      leon3      leon3v7
+
+MULTILIB_OPTIONS        += mfix-ut699/mfix-ut700/mfix-gr712rc/mfix-at697f
+MULTILIB_DIRNAMES       += mfix-ut699 mfix-ut700 mfix-gr712rc mfix-at697f
+
+MULTILIB_OPTIONS        += mfix-b2bst mfix-tn0013
+MULTILIB_DIRNAMES       += mfix-b2bst mfix-tn0013
+
+MULTILIB_OPTIONS        += msoft-float
+MULTILIB_DIRNAMES       += soft
+
+MULTILIB_OPTIONS        += mflat
+MULTILIB_DIRNAMES       += flat
+
+MULTILIB_MATCHES         = msoft-float=mno-fpu
+
+
+# This is the complete list of multilibs to build
+MULTILIB_REQUIRED       =
+
+
+MULTILIB_REQUIRED += msoft-float
+MULTILIB_REQUIRED += mflat
+MULTILIB_REQUIRED += msoft-float/mflat
+
+MULTILIB_REQUIRED += mfix-b2bst/msoft-float
+MULTILIB_REQUIRED += mfix-b2bst/msoft-float/mflat
+
+MULTILIB_REQUIRED += mfix-tn0013
+MULTILIB_REQUIRED += mfix-tn0013/mflat
+
+MULTILIB_REQUIRED += mfix-b2bst/mfix-tn0013
+MULTILIB_REQUIRED += mfix-b2bst/mfix-tn0013/mflat
+
+
+MULTILIB_REQUIRED += mcpu=leon
+MULTILIB_REQUIRED += mcpu=leon/msoft-float
+MULTILIB_REQUIRED += mcpu=leon/mflat
+MULTILIB_REQUIRED += mcpu=leon/msoft-float/mflat
+
+
+MULTILIB_REQUIRED += mcpu=leon3
+MULTILIB_REQUIRED += mcpu=leon3/msoft-float
+MULTILIB_REQUIRED += mcpu=leon3/mflat
+MULTILIB_REQUIRED += mcpu=leon3/msoft-float/mflat
+
+MULTILIB_REQUIRED += mcpu=leon3/mfix-b2bst/msoft-float
+MULTILIB_REQUIRED += mcpu=leon3/mfix-b2bst/msoft-float/mflat
+
+MULTILIB_REQUIRED += mcpu=leon3/mfix-tn0013
+MULTILIB_REQUIRED += mcpu=leon3/mfix-tn0013/mflat
+
+MULTILIB_REQUIRED += mcpu=leon3/mfix-b2bst/mfix-tn0013
+MULTILIB_REQUIRED += mcpu=leon3/mfix-b2bst/mfix-tn0013/mflat
+
+
+MULTILIB_REQUIRED += mcpu=leon3v7
+MULTILIB_REQUIRED += mcpu=leon3v7/msoft-float
+MULTILIB_REQUIRED += mcpu=leon3v7/mflat
+MULTILIB_REQUIRED += mcpu=leon3v7/msoft-float/mflat
+
+MULTILIB_REQUIRED += mcpu=leon3v7/mfix-b2bst/msoft-float
+MULTILIB_REQUIRED += mcpu=leon3v7/mfix-b2bst/msoft-float/mflat
+
+MULTILIB_REQUIRED += mcpu=leon3v7/mfix-tn0013
+MULTILIB_REQUIRED += mcpu=leon3v7/mfix-tn0013/mflat
+
+MULTILIB_REQUIRED += mcpu=leon3v7/mfix-b2bst/mfix-tn0013
+MULTILIB_REQUIRED += mcpu=leon3v7/mfix-b2bst/mfix-tn0013/mflat
+
+
+MULTILIB_REQUIRED += mcpu=leon/mfix-ut699
+MULTILIB_REQUIRED += mcpu=leon/mfix-ut699/msoft-float
+MULTILIB_REQUIRED += mcpu=leon/mfix-ut699/mflat
+MULTILIB_REQUIRED += mcpu=leon/mfix-ut699/msoft-float/mflat
+
+MULTILIB_REQUIRED += mcpu=leon3/mfix-ut700
+MULTILIB_REQUIRED += mcpu=leon3/mfix-ut700/msoft-float
+MULTILIB_REQUIRED += mcpu=leon3/mfix-ut700/mflat
+MULTILIB_REQUIRED += mcpu=leon3/mfix-ut700/msoft-float/mflat
+
+MULTILIB_REQUIRED += mcpu=leon3/mfix-gr712rc
+MULTILIB_REQUIRED += mcpu=leon3/mfix-gr712rc/msoft-float
+MULTILIB_REQUIRED += mcpu=leon3/mfix-gr712rc/mflat
+MULTILIB_REQUIRED += mcpu=leon3/mfix-gr712rc/msoft-float/mflat
+
+MULTILIB_REQUIRED += mcpu=leon/mfix-at697f
+MULTILIB_REQUIRED += mcpu=leon/mfix-at697f/msoft-float
+MULTILIB_REQUIRED += mcpu=leon/mfix-at697f/mflat
+MULTILIB_REQUIRED += mcpu=leon/mfix-at697f/msoft-float/mflat
+
-- 
2.34.1

