From 5ae1a11a43221087a733e81f91db9ad20d71bab6 Mon Sep 17 00:00:00 2001
From: Martin Aberg <maberg@gaisler.com>
Date: Fri, 6 Nov 2020 12:17:05 +0100
Subject: [PATCH 36/50] ncc: Add NCC target

---
 gcc/config.gcc                  |  9 ++++++++
 gcc/config/riscv/ncc.h          | 41 +++++++++++++++++++++++++++++++++
 gcc/config/riscv/ncc.opt        |  4 ++++
 gcc/config/riscv/t-ncc-multilib | 38 ++++++++++++++++++++++++++++++
 4 files changed, 92 insertions(+)
 create mode 100644 gcc/config/riscv/ncc.h
 create mode 100644 gcc/config/riscv/ncc.opt
 create mode 100644 gcc/config/riscv/t-ncc-multilib

diff --git a/gcc/config.gcc b/gcc/config.gcc
index fd452044cfc..42db4993023 100644
--- a/gcc/config.gcc
+++ b/gcc/config.gcc
@@ -2449,6 +2449,15 @@ riscv*-*-elf* | riscv*-*-rtems*)
 	  tm_file="${tm_file} rtems.h riscv/rtems.h"
 	  tmake_file="${tmake_file} riscv/t-rtems"
 	  ;;
+	*-gaisler-elf*)
+	  case "x${enable_multilib}" in
+	  xno) ;;
+	  xyes) tmake_file="${tmake_file} riscv/t-ncc-multilib" ;;
+	  *) echo "Unknown value for enable_multilib"; exit 1
+	  esac
+	  tm_file="${tm_file} riscv/ncc.h"
+	  extra_options="${extra_options} riscv/ncc.opt"
+	  ;;
 	*)
 	  case "x${enable_multilib}" in
 	  xno) ;;
diff --git a/gcc/config/riscv/ncc.h b/gcc/config/riscv/ncc.h
new file mode 100644
index 00000000000..1063ad76db9
--- /dev/null
+++ b/gcc/config/riscv/ncc.h
@@ -0,0 +1,41 @@
+/* Definitions for NOEL-V running on Cobham Gaisler toolchain
+   Copyright (C) 2016 Free Software Foundation, Inc.
+   Contributed by Martin Aberg (maberg@gaisler.com).
+
+This file is part of GNU CC.
+
+GNU CC is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2, or (at your option)
+any later version.
+
+GNU CC is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with GNU CC; see the file COPYING.  If not, write to
+the Free Software Foundation, 59 Temple Place - Suite 330,
+Boston, MA 02111-1307, USA.  */
+
+/* Allow user to specify a BSP not in the default location. */
+#undef DRIVER_SELF_SPECS
+#define DRIVER_SELF_SPECS \
+" \
+%{!B: \
+  %{qbsp=*:-B %R/bsp/%*} \
+  %{!qbsp*:-B %R/bsp/2020q4} \
+} \
+"
+
+#undef STARTFILE_SPEC
+#define STARTFILE_SPEC "first.S.o%s crt0.S.o%s crtbegin%O%s"
+
+#undef LIB_SPEC
+#define LIB_SPEC "--start-group -lbcc -lc --end-group"
+
+/* Use the default */
+#undef LINK_GCC_C_SEQUENCE_SPEC
+#define LINK_GCC_C_SEQUENCE_SPEC "%{!T*: -T linkcmds%s} %G %{!nolibc:%L %G}"
+
diff --git a/gcc/config/riscv/ncc.opt b/gcc/config/riscv/ncc.opt
new file mode 100644
index 00000000000..a64866ac0aa
--- /dev/null
+++ b/gcc/config/riscv/ncc.opt
@@ -0,0 +1,4 @@
+qbsp=
+Driver
+Select BSP
+
diff --git a/gcc/config/riscv/t-ncc-multilib b/gcc/config/riscv/t-ncc-multilib
new file mode 100644
index 00000000000..c305e273e6f
--- /dev/null
+++ b/gcc/config/riscv/t-ncc-multilib
@@ -0,0 +1,38 @@
+# This file was generated by multilib-generator with the command:
+#  ./multilib-generator rv32i-ilp32-- rv32ic-ilp32-- rv32im-ilp32-- rv32imc-ilp32-- rv32ima-ilp32-- rv32imac-ilp32-- rv32imafd-ilp32d-- rv32imafdc-ilp32d-- rv64ima-lp64-- rv64imac-lp64-- rv64imafd-lp64d-- rv64imafdc-lp64d--
+MULTILIB_OPTIONS = march=rv32i/march=rv32ic/march=rv32im/march=rv32imc/march=rv32ima/march=rv32imac/march=rv32imafd/march=rv32g/march=rv32imafdc/march=rv32gc/march=rv64ima/march=rv64imac/march=rv64imafd/march=rv64g/march=rv64imafdc/march=rv64gc mabi=ilp32/mabi=ilp32d/mabi=lp64/mabi=lp64d
+MULTILIB_DIRNAMES = rv32i \
+rv32ic \
+rv32im \
+rv32imc \
+rv32ima \
+rv32imac \
+rv32imafd \
+rv32g \
+rv32imafdc \
+rv32gc \
+rv64ima \
+rv64imac \
+rv64imafd \
+rv64g \
+rv64imafdc \
+rv64gc ilp32 \
+ilp32d \
+lp64 \
+lp64d
+MULTILIB_REQUIRED = march=rv32i/mabi=ilp32 \
+march=rv32ic/mabi=ilp32 \
+march=rv32im/mabi=ilp32 \
+march=rv32imc/mabi=ilp32 \
+march=rv32ima/mabi=ilp32 \
+march=rv32imac/mabi=ilp32 \
+march=rv32imafd/mabi=ilp32d \
+march=rv32imafdc/mabi=ilp32d \
+march=rv64ima/mabi=lp64 \
+march=rv64imac/mabi=lp64 \
+march=rv64imafd/mabi=lp64d \
+march=rv64imafdc/mabi=lp64d
+MULTILIB_REUSE = march.rv32imafd/mabi.ilp32d=march.rv32g/mabi.ilp32d \
+march.rv32imafdc/mabi.ilp32d=march.rv32gc/mabi.ilp32d \
+march.rv64imafd/mabi.lp64d=march.rv64g/mabi.lp64d \
+march.rv64imafdc/mabi.lp64d=march.rv64gc/mabi.lp64d
-- 
2.34.1

