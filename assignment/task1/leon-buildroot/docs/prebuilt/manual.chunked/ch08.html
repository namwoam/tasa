<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Chapter 8. General Buildroot usage</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="home" href="index.html" title="The Buildroot user manual" /><link rel="up" href="pt02.html" title="Part II. User guide" /><link rel="prev" href="ch07.html" title="Chapter 7. Configuration of other components" /><link rel="next" href="ch09.html" title="Chapter 9. Project-specific customization" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="ch07.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch09.html">Next</a></td></tr></table><hr /></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_general_buildroot_usage"></a>Chapter 8. General Buildroot usage</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="make-tips"></a>8.1. <span class="emphasis"><em>make</em></span> tips</h2></div></div></div><p>This is a collection of tips that help you make the most of Buildroot.</p><p><strong>Display all commands executed by make: </strong>
</p><pre class="screen"> $ make V=1 &lt;target&gt;</pre><p>
</p><p><strong>Display the list of boards with a defconfig: </strong>
</p><pre class="screen"> $ make list-defconfigs</pre><p>
</p><p><strong>Display all available targets: </strong>
</p><pre class="screen"> $ make help</pre><p>
</p><p>Not all targets are always available,
some settings in the <code class="literal">.config</code> file may hide some targets:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">busybox-menuconfig</code> only works when <code class="literal">busybox</code> is enabled;
</li><li class="listitem">
<code class="literal">linux-menuconfig</code> and <code class="literal">linux-savedefconfig</code> only work when
  <code class="literal">linux</code> is enabled;
</li><li class="listitem">
<code class="literal">uclibc-menuconfig</code> is only available when the uClibc C library is
  selected in the internal toolchain backend;
</li><li class="listitem">
<code class="literal">barebox-menuconfig</code> and <code class="literal">barebox-savedefconfig</code> only work when the
  <code class="literal">barebox</code> bootloader is enabled.
</li><li class="listitem">
<code class="literal">uboot-menuconfig</code> and <code class="literal">uboot-savedefconfig</code> only work when the
  <code class="literal">U-Boot</code> bootloader is enabled and the <code class="literal">uboot</code> build system is set
  to <code class="literal">Kconfig</code>.
</li></ul></div><p><strong>Cleaning: </strong>Explicit cleaning is required when any of the architecture or toolchain
configuration options are changed.</p><p>To delete all build products (including build directories, host, staging
and target trees, the images and the toolchain):</p><pre class="screen"> $ make clean</pre><p><strong>Generating the manual: </strong>The present manual sources are located in the <span class="emphasis"><em>docs/manual</em></span> directory.
To generate the manual:</p><pre class="screen"> $ make manual-clean
 $ make manual</pre><p>The manual outputs will be generated in <span class="emphasis"><em>output/docs/manual</em></span>.</p><div class="itemizedlist"><p class="title"><strong>Notes</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
A few tools are required to build the documentation (see:
  <a class="xref" href="ch02.html#requirement-optional" title="2.2. Optional packages">Section 2.2, “Optional packages”</a>).
</li></ul></div><p><strong>Resetting Buildroot for a new target: </strong>To delete all build products as well as the configuration:</p><pre class="screen"> $ make distclean</pre><p><strong>Notes. </strong>If <code class="literal">ccache</code> is enabled, running <code class="literal">make clean</code> or <code class="literal">distclean</code> does
not empty the compiler cache used by Buildroot. To delete it, refer
to <a class="xref" href="ch08.html#ccache" title="8.14.3. Using ccache in Buildroot">Section 8.14.3, “Using <code class="literal">ccache</code> in Buildroot”</a>.</p><p><strong>Dumping the internal make variables: </strong>One can dump the variables known to make, along with their values:</p><pre class="screen"> $ make -s printvars VARS='VARIABLE1 VARIABLE2'
 VARIABLE1=value_of_variable
 VARIABLE2=value_of_variable</pre><p>It is possible to tweak the output using some variables:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">VARS</code> will limit the listing to variables which names match the
  specified make-patterns - this must be set else nothing is printed
</li><li class="listitem">
<code class="literal">QUOTED_VARS</code>, if set to <code class="literal">YES</code>, will single-quote the value
</li><li class="listitem">
<code class="literal">RAW_VARS</code>, if set to <code class="literal">YES</code>, will print the unexpanded value
</li></ul></div><p>For example:</p><pre class="screen"> $ make -s printvars VARS=BUSYBOX_%DEPENDENCIES
 BUSYBOX_DEPENDENCIES=skeleton toolchain
 BUSYBOX_FINAL_ALL_DEPENDENCIES=skeleton toolchain
 BUSYBOX_FINAL_DEPENDENCIES=skeleton toolchain
 BUSYBOX_FINAL_PATCH_DEPENDENCIES=
 BUSYBOX_RDEPENDENCIES=ncurses util-linux</pre><pre class="screen"> $ make -s printvars VARS=BUSYBOX_%DEPENDENCIES QUOTED_VARS=YES
 BUSYBOX_DEPENDENCIES='skeleton toolchain'
 BUSYBOX_FINAL_ALL_DEPENDENCIES='skeleton toolchain'
 BUSYBOX_FINAL_DEPENDENCIES='skeleton toolchain'
 BUSYBOX_FINAL_PATCH_DEPENDENCIES=''
 BUSYBOX_RDEPENDENCIES='ncurses util-linux'</pre><pre class="screen"> $ make -s printvars VARS=BUSYBOX_%DEPENDENCIES RAW_VARS=YES
 BUSYBOX_DEPENDENCIES=skeleton toolchain
 BUSYBOX_FINAL_ALL_DEPENDENCIES=$(sort $(BUSYBOX_FINAL_DEPENDENCIES) $(BUSYBOX_FINAL_PATCH_DEPENDENCIES))
 BUSYBOX_FINAL_DEPENDENCIES=$(sort $(BUSYBOX_DEPENDENCIES))
 BUSYBOX_FINAL_PATCH_DEPENDENCIES=$(sort $(BUSYBOX_PATCH_DEPENDENCIES))
 BUSYBOX_RDEPENDENCIES=ncurses util-linux</pre><p>The output of quoted variables can be reused in shell scripts, for example:</p><pre class="screen"> $ eval $(make -s printvars VARS=BUSYBOX_DEPENDENCIES QUOTED_VARS=YES)
 $ echo $BUSYBOX_DEPENDENCIES
 skeleton toolchain</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="full-rebuild"></a>8.2. Understanding when a full rebuild is necessary</h2></div></div></div><p>Buildroot does not attempt to detect what parts of the system should
be rebuilt when the system configuration is changed through <code class="literal">make
menuconfig</code>, <code class="literal">make xconfig</code> or one of the other configuration
tools. In some cases, Buildroot should rebuild the entire system, in
some cases, only a specific subset of packages. But detecting this in
a completely reliable manner is very difficult, and therefore the
Buildroot developers have decided to simply not attempt to do this.</p><p>Instead, it is the responsibility of the user to know when a full
rebuild is necessary. As a hint, here are a few rules of thumb that
can help you understand how to work with Buildroot:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
When the target architecture configuration is changed, a complete
   rebuild is needed. Changing the architecture variant, the binary
   format or the floating point strategy for example has an impact on
   the entire system.
</li><li class="listitem">
When the toolchain configuration is changed, a complete rebuild
   generally is needed. Changing the toolchain configuration often
   involves changing the compiler version, the type of C library or
   its configuration, or some other fundamental configuration item,
   and these changes have an impact on the entire system.
</li><li class="listitem">
When an additional package is added to the configuration, a full
   rebuild is not necessarily needed. Buildroot will detect that this
   package has never been built, and will build it. However, if this
   package is a library that can optionally be used by packages that
   have already been built, Buildroot will not automatically rebuild
   those. Either you know which packages should be rebuilt, and you
   can rebuild them manually, or you should do a full rebuild. For
   example, let’s suppose you have built a system with the <code class="literal">ctorrent</code>
   package, but without <code class="literal">openssl</code>. Your system works, but you realize
   you would like to have SSL support in <code class="literal">ctorrent</code>, so you enable the
   <code class="literal">openssl</code> package in Buildroot configuration and restart the
   build. Buildroot will detect that <code class="literal">openssl</code> should be built and
   will be build it, but it will not detect that <code class="literal">ctorrent</code> should be
   rebuilt to benefit from <code class="literal">openssl</code> to add OpenSSL support. You will
   either have to do a full rebuild, or rebuild <code class="literal">ctorrent</code> itself.
</li><li class="listitem">
When a package is removed from the configuration, Buildroot does
   not do anything special. It does not remove the files installed by
   this package from the target root filesystem or from the toolchain
   <span class="emphasis"><em>sysroot</em></span>. A full rebuild is needed to get rid of this
   package. However, generally you don’t necessarily need this package
   to be removed right now: you can wait for the next lunch break to
   restart the build from scratch.
</li><li class="listitem">
When the sub-options of a package are changed, the package is not
   automatically rebuilt. After making such changes, rebuilding only
   this package is often sufficient, unless enabling the package
   sub-option adds some features to the package that are useful for
   another package which has already been built. Again, Buildroot does
   not track when a package should be rebuilt: once a package has been
   built, it is never rebuilt unless explicitly told to do so.
</li><li class="listitem">
When a change to the root filesystem skeleton is made, a full
   rebuild is needed. However, when changes to the root filesystem
   overlay, a post-build script or a post-image script are made,
   there is no need for a full rebuild: a simple <code class="literal">make</code> invocation
   will take the changes into account.
</li><li class="listitem">
When a package listed in <code class="literal">FOO_DEPENDENCIES</code> is rebuilt or removed,
   the package <code class="literal">foo</code> is not automatically rebuilt. For example, if a
   package <code class="literal">bar</code> is listed in <code class="literal">FOO_DEPENDENCIES</code> with <code class="literal">FOO_DEPENDENCIES
   = bar</code> and the configuration of the <code class="literal">bar</code> package is changed, the
   configuration change would not result in a rebuild of package <code class="literal">foo</code>
   automatically. In this scenario, you may need to either rebuild any
   packages in your build which reference <code class="literal">bar</code> in their <code class="literal">DEPENDENCIES</code>,
   or perform a full rebuild to ensure any <code class="literal">bar</code> dependent packages are
   up to date.
</li></ul></div><p>Generally speaking, when you’re facing a build error and you’re unsure
of the potential consequences of the configuration changes you’ve
made, do a full rebuild. If you get the same build error, then you are
sure that the error is not related to partial rebuilds of packages,
and if this error occurs with packages from the official Buildroot, do
not hesitate to report the problem! As your experience with Buildroot
progresses, you will progressively learn when a full rebuild is really
necessary, and you will save more and more time.</p><p>For reference, a full rebuild is achieved by running:</p><pre class="screen">$ make clean all</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="rebuild-pkg"></a>8.3. Understanding how to rebuild packages</h2></div></div></div><p>One of the most common questions asked by Buildroot users is how to
rebuild a given package or how to remove a package without rebuilding
everything from scratch.</p><p>Removing a package is unsupported by Buildroot without
rebuilding from scratch. This is because Buildroot doesn’t keep track
of which package installs what files in the <code class="literal">output/staging</code> and
<code class="literal">output/target</code> directories, or which package would be compiled differently
depending on the availability of another package.</p><p>The easiest way to rebuild a single package from scratch is to remove
its build directory in <code class="literal">output/build</code>. Buildroot will then re-extract,
re-configure, re-compile and re-install this package from scratch. You
can ask buildroot to do this with the <code class="literal">make &lt;package&gt;-dirclean</code> command.</p><p>On the other hand, if you only want to restart the build process of a
package from its compilation step, you can run <code class="literal">make &lt;package&gt;-rebuild</code>. It
will restart the compilation and installation of the package, but not from
scratch: it basically re-executes <code class="literal">make</code> and <code class="literal">make install</code> inside the package,
so it will only rebuild files that changed.</p><p>If you want to restart the build process of a package from its configuration
step, you can run <code class="literal">make &lt;package&gt;-reconfigure</code>. It will restart the
configuration, compilation and installation of the package.</p><p>While <code class="literal">&lt;package&gt;-rebuild</code> implies <code class="literal">&lt;package&gt;-reinstall</code> and
<code class="literal">&lt;package&gt;-reconfigure</code> implies <code class="literal">&lt;package&gt;-rebuild</code>, these targets as well
as <code class="literal">&lt;package&gt;</code> only act on the said package, and do not trigger re-creating
the root filesystem image. If re-creating the root filesystem in necessary,
one should in addition run <code class="literal">make</code> or <code class="literal">make all</code>.</p><p>Internally, Buildroot creates so-called <span class="emphasis"><em>stamp files</em></span> to keep track of
which build steps have been completed for each package. They are
stored in the package build directory,
<code class="literal">output/build/&lt;package&gt;-&lt;version&gt;/</code> and are named
<code class="literal">.stamp_&lt;step-name&gt;</code>. The commands detailed above simply manipulate
these stamp files to force Buildroot to restart a specific set of
steps of a package build process.</p><p>Further details about package special make targets are explained in
<a class="xref" href="ch08.html#pkg-build-steps" title="8.14.5. Package-specific make targets">Section 8.14.5, “Package-specific <span class="emphasis"><em>make</em></span> targets”</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_offline_builds"></a>8.4. Offline builds</h2></div></div></div><p>If you intend to do an offline build and just want to download
all sources that you previously selected in the configurator
(<span class="emphasis"><em>menuconfig</em></span>, <span class="emphasis"><em>nconfig</em></span>, <span class="emphasis"><em>xconfig</em></span> or <span class="emphasis"><em>gconfig</em></span>), then issue:</p><pre class="screen"> $ make source</pre><p>You can now disconnect or copy the content of your <code class="literal">dl</code>
directory to the build-host.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_building_out_of_tree"></a>8.5. Building out-of-tree</h2></div></div></div><p>As default, everything built by Buildroot is stored in the directory
<code class="literal">output</code> in the Buildroot tree.</p><p>Buildroot also supports building out of tree with a syntax similar to
the Linux kernel. To use it, add <code class="literal">O=&lt;directory&gt;</code> to the make command
line:</p><pre class="screen"> $ make O=/tmp/build menuconfig</pre><p>Or:</p><pre class="screen"> $ cd /tmp/build; make O=$PWD -C path/to/buildroot menuconfig</pre><p>All the output files will be located under <code class="literal">/tmp/build</code>. If the <code class="literal">O</code>
path does not exist, Buildroot will create it.</p><p><span class="strong"><strong>Note:</strong></span> the <code class="literal">O</code> path can be either an absolute or a relative path, but if it’s
passed as a relative path, it is important to note that it is interpreted
relative to the main Buildroot source directory, <span class="strong"><strong>not</strong></span> the current working
directory.</p><p>When using out-of-tree builds, the Buildroot <code class="literal">.config</code> and temporary
files are also stored in the output directory. This means that you can
safely run multiple builds in parallel using the same source tree as
long as they use unique output directories.</p><p>For ease of use, Buildroot generates a Makefile wrapper in the output
directory - so after the first run, you no longer need to pass <code class="literal">O=&lt;…&gt;</code>
and <code class="literal">-C &lt;…&gt;</code>, simply run (in the output directory):</p><pre class="screen"> $ make &lt;target&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="env-vars"></a>8.6. Environment variables</h2></div></div></div><p>Buildroot also honors some environment variables, when they are passed
to <code class="literal">make</code> or set in the environment:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">HOSTCXX</code>, the host C++ compiler to use
</li><li class="listitem">
<code class="literal">HOSTCC</code>, the host C compiler to use
</li><li class="listitem">
<code class="literal">UCLIBC_CONFIG_FILE=&lt;path/to/.config&gt;</code>, path to
  the uClibc configuration file, used to compile uClibc, if an
  internal toolchain is being built.
 
  Note that the uClibc configuration file can also be set from the
  configuration interface, so through the Buildroot <code class="literal">.config</code> file; this
  is the recommended way of setting it.
 
</li><li class="listitem">
<code class="literal">BUSYBOX_CONFIG_FILE=&lt;path/to/.config&gt;</code>, path to
  the BusyBox configuration file.
 
  Note that the BusyBox configuration file can also be set from the
  configuration interface, so through the Buildroot <code class="literal">.config</code> file; this
  is the recommended way of setting it.
 
</li><li class="listitem">
<code class="literal">BR2_CCACHE_DIR</code> to override the directory where
  Buildroot stores the cached files when using ccache.
 
</li><li class="listitem">
<code class="literal">BR2_DL_DIR</code> to override the directory in which
  Buildroot stores/retrieves downloaded files.
 
  Note that the Buildroot download directory can also be set from the
  configuration interface, so through the Buildroot <code class="literal">.config</code> file. See
  <a class="xref" href="ch08.html#download-location" title="8.14.4. Location of downloaded packages">Section 8.14.4, “Location of downloaded packages”</a> for more details on how you can set the download
  directory.
</li><li class="listitem">
<code class="literal">BR2_GRAPH_ALT</code>, if set and non-empty, to use an alternate color-scheme in
  build-time graphs
</li><li class="listitem">
<code class="literal">BR2_GRAPH_OUT</code> to set the filetype of generated graphs, either <code class="literal">pdf</code> (the
  default), or <code class="literal">png</code>.
</li><li class="listitem">
<code class="literal">BR2_GRAPH_DEPS_OPTS</code> to pass extra options to the dependency graph; see
  <a class="xref" href="ch08.html#graph-depends">Section 8.9, “Graphing the dependencies between packages”</a> for the accepted options
</li><li class="listitem">
<code class="literal">BR2_GRAPH_DOT_OPTS</code> is passed verbatim as options to the <code class="literal">dot</code> utility to
  draw the dependency graph.
</li><li class="listitem">
<code class="literal">BR2_GRAPH_SIZE_OPTS</code> to pass extra options to the size graph; see
  <a class="xref" href="ch08.html#graph-size" title="8.11. Graphing the filesystem size contribution of packages">Section 8.11, “Graphing the filesystem size contribution of packages”</a> for the acepted options
</li></ul></div><p>An example that uses config files located in the toplevel directory and
in your $HOME:</p><pre class="screen"> $ make UCLIBC_CONFIG_FILE=uClibc.config BUSYBOX_CONFIG_FILE=$HOME/bb.config</pre><p>If you want to use a compiler other than the default <code class="literal">gcc</code>
or <code class="literal">g</code>++ for building helper-binaries on your host, then do</p><pre class="screen"> $ make HOSTCXX=g++-4.3-HEAD HOSTCC=gcc-4.3-HEAD</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_dealing_efficiently_with_filesystem_images"></a>8.7. Dealing efficiently with filesystem images</h2></div></div></div><p>Filesystem images can get pretty big, depending on the filesystem you choose,
the number of packages, whether you provisioned free space… Yet, some
locations in the filesystems images may just be <span class="emphasis"><em>empty</em></span> (e.g. a long run of
<span class="emphasis"><em>zeroes</em></span>); such a file is called a <span class="emphasis"><em>sparse</em></span> file.</p><p>Most tools can handle sparse files efficiently, and will only store or write
those parts of a sparse file that are not empty.</p><p>For example:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p class="simpara">
<code class="literal">tar</code> accepts the <code class="literal">-S</code> option to tell it to only store non-zero blocks
  of sparse files:
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
<code class="literal">tar cf archive.tar -S [files…]</code> will efficiently store sparse files
   in a tarball
</li><li class="listitem">
<code class="literal">tar xf archive.tar -S</code> will efficiently store sparse files extracted
   from a tarball
</li></ul></div></li><li class="listitem"><p class="simpara">
<code class="literal">cp</code> accepts the <code class="literal">--sparse=WHEN</code> option (<code class="literal">WHEN</code> is one of <code class="literal">auto</code>,
  <code class="literal">never</code> or <code class="literal">always</code>):
</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem">
<code class="literal">cp --sparse=always source.file dest.file</code> will make <code class="literal">dest.file</code> a
   sparse file if <code class="literal">source.file</code> has long runs of zeroes
</li></ul></div></li></ul></div><p>Other tools may have similar options. Please consult their respective man
pages.</p><p>You can use sparse files if you need to store the filesystem images (e.g.
to transfer from one machine to another), or if you need to send them (e.g.
to the Q&amp;A team).</p><p>Note however that flashing a filesystem image to a device while using the
sparse mode of <code class="literal">dd</code> may result in a broken filesystem (e.g. the block bitmap
of an ext2 filesystem may be corrupted; or, if you have sparse files in
your filesystem, those parts may not be all-zeroes when read back). You
should only use sparse files when handling files on the build machine, not
when transferring them to an actual device that will be used on the target.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_details_about_packages"></a>8.8. Details about packages</h2></div></div></div><p><a id="package-details"></a>Buildroot can produce a JSON blurb that describes the set of enabled
packages in the current configuration, together with their
dependencies, licenses and other metadata. This JSON blurb is produced
by using the <code class="literal">show-info</code> make target:</p><pre class="screen">make show-info</pre><p>Buildroot can also produce details about packages as HTML and JSON
output using the <code class="literal">pkg-stats</code> make target. Amongst other things, these
details include whether known CVEs (security vulnerabilities) affect
the packages in your current configuration. It also shows if there is
a newer upstream version for those packages.</p><pre class="screen">make pkg-stats</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_graphing_the_dependencies_between_packages"></a>8.9. Graphing the dependencies between packages</h2></div></div></div><p><a id="graph-depends"></a>One of Buildroot’s jobs is to know the dependencies between packages,
and make sure they are built in the right order. These dependencies
can sometimes be quite complicated, and for a given system, it is
often not easy to understand why such or such package was brought into
the build by Buildroot.</p><p>In order to help understanding the dependencies, and therefore better
understand what is the role of the different components in your
embedded Linux system, Buildroot is capable of generating dependency
graphs.</p><p>To generate a dependency graph of the full system you have compiled,
simply run:</p><pre class="screen">make graph-depends</pre><p>You will find the generated graph in
<code class="literal">output/graphs/graph-depends.pdf</code>.</p><p>If your system is quite large, the dependency graph may be too complex
and difficult to read. It is therefore possible to generate the
dependency graph just for a given package:</p><pre class="screen">make &lt;pkg&gt;-graph-depends</pre><p>You will find the generated graph in
<code class="literal">output/graph/&lt;pkg&gt;-graph-depends.pdf</code>.</p><p>Note that the dependency graphs are generated using the <code class="literal">dot</code> tool
from the <span class="emphasis"><em>Graphviz</em></span> project, which you must have installed on your
system to use this feature. In most distributions, it is available as
the <code class="literal">graphviz</code> package.</p><p>By default, the dependency graphs are generated in the PDF
format. However, by passing the <code class="literal">BR2_GRAPH_OUT</code> environment variable, you
can switch to other output formats, such as PNG, PostScript or
SVG. All formats supported by the <code class="literal">-T</code> option of the <code class="literal">dot</code> tool are
supported.</p><pre class="screen">BR2_GRAPH_OUT=svg make graph-depends</pre><p>The <code class="literal">graph-depends</code> behaviour can be controlled by setting options in the
<code class="literal">BR2_GRAPH_DEPS_OPTS</code> environment variable. The accepted options are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">--depth N</code>, <code class="literal">-d N</code>, to limit the dependency depth to <code class="literal">N</code> levels. The
  default, <code class="literal">0</code>, means no limit.
</li><li class="listitem">
<code class="literal">--stop-on PKG</code>, <code class="literal">-s PKG</code>, to stop the graph on the package <code class="literal">PKG</code>.
  <code class="literal">PKG</code> can be an actual package name, a glob, the keyword <span class="emphasis"><em>virtual</em></span>
  (to stop on virtual packages), or the keyword <span class="emphasis"><em>host</em></span> (to stop on
  host packages). The package is still present on the graph, but its
  dependencies are not.
</li><li class="listitem">
<code class="literal">--exclude PKG</code>, <code class="literal">-x PKG</code>, like <code class="literal">--stop-on</code>, but also omits <code class="literal">PKG</code> from
  the graph.
</li><li class="listitem">
<code class="literal">--transitive</code>, <code class="literal">--no-transitive</code>, to draw (or not) the transitive
  dependencies. The default is to not draw transitive dependencies.
</li><li class="listitem">
<code class="literal">--colors R,T,H</code>, the comma-separated list of colors to draw the
  root package (<code class="literal">R</code>), the target packages (<code class="literal">T</code>) and the host packages
  (<code class="literal">H</code>). Defaults to: <code class="literal">lightblue,grey,gainsboro</code>
</li></ul></div><pre class="screen">BR2_GRAPH_DEPS_OPTS='-d 3 --no-transitive --colors=red,green,blue' make graph-depends</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_graphing_the_build_duration"></a>8.10. Graphing the build duration</h2></div></div></div><p><a id="graph-duration"></a>When the build of a system takes a long time, it is sometimes useful
to be able to understand which packages are the longest to build, to
see if anything can be done to speed up the build. In order to help
such build time analysis, Buildroot collects the build time of each
step of each package, and allows to generate graphs from this data.</p><p>To generate the build time graph after a build, run:</p><pre class="screen">make graph-build</pre><p>This will generate a set of files in <code class="literal">output/graphs</code> :</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">build.hist-build.pdf</code>, a histogram of the build time for each
  package, ordered in the build order.
</li><li class="listitem">
<code class="literal">build.hist-duration.pdf</code>, a histogram of the build time for each
  package, ordered by duration (longest first)
</li><li class="listitem">
<code class="literal">build.hist-name.pdf</code>, a histogram of the build time for each
  package, order by package name.
</li><li class="listitem">
<code class="literal">build.pie-packages.pdf</code>, a pie chart of the build time per package
</li><li class="listitem">
<code class="literal">build.pie-steps.pdf</code>, a pie chart of the global time spent in each
  step of the packages build process.
</li></ul></div><p>This <code class="literal">graph-build</code> target requires the Python Matplotlib and Numpy
libraries to be installed (<code class="literal">python-matplotlib</code> and <code class="literal">python-numpy</code> on
most distributions), and also the <code class="literal">argparse</code> module if you’re using a
Python version older than 2.7 (<code class="literal">python-argparse</code> on most
distributions).</p><p>By default, the output format for the graph is PDF, but a different
format can be selected using the <code class="literal">BR2_GRAPH_OUT</code> environment variable. The
only other format supported is PNG:</p><pre class="screen">BR2_GRAPH_OUT=png make graph-build</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="graph-size"></a>8.11. Graphing the filesystem size contribution of packages</h2></div></div></div><p>When your target system grows, it is sometimes useful to understand
how much each Buildroot package is contributing to the overall root
filesystem size. To help with such an analysis, Buildroot collects
data about files installed by each package and using this data,
generates a graph and CSV files detailing the size contribution of
the different packages.</p><p>To generate these data after a build, run:</p><pre class="screen">make graph-size</pre><p>This will generate:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">output/graphs/graph-size.pdf</code>, a pie chart of the contribution of
  each package to the overall root filesystem size
</li><li class="listitem">
<code class="literal">output/graphs/package-size-stats.csv</code>, a CSV file giving the size
  contribution of each package to the overall root filesystem size
</li><li class="listitem">
<code class="literal">output/graphs/file-size-stats.csv</code>, a CSV file giving the size
  contribution of each installed file to the package it belongs, and
  to the overall filesystem size.
</li></ul></div><p>This <code class="literal">graph-size</code> target requires the Python Matplotlib library to be
installed (<code class="literal">python-matplotlib</code> on most distributions), and also the
<code class="literal">argparse</code> module if you’re using a Python version older than 2.7
(<code class="literal">python-argparse</code> on most distributions).</p><p>Just like for the duration graph, a <code class="literal">BR2_GRAPH_OUT</code> environment variable
is supported to adjust the output file format. See <a class="xref" href="ch08.html#graph-depends">Section 8.9, “Graphing the dependencies between packages”</a>
for details about this environment variable.</p><p>Additionally, one may set the environment variable <code class="literal">BR2_GRAPH_SIZE_OPTS</code>
to further control the generated graph. Accepted options are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<code class="literal">--size-limit X</code>, <code class="literal">-l X</code>, will group all packages which individual
  contribution is below <code class="literal">X</code> percent, to a single entry labelled <span class="emphasis"><em>Others</em></span>
  in the graph. By default, <code class="literal">X=0.01</code>, which means packages each
  contributing less than 1% are grouped under <span class="emphasis"><em>Others</em></span>. Accepted values
  are in the range <code class="literal">[0.0..1.0]</code>.
</li><li class="listitem">
<code class="literal">--iec</code>, <code class="literal">--binary</code>, <code class="literal">--si</code>, <code class="literal">--decimal</code>, to use IEC (binary, powers
  of 1024) or SI (decimal, powers of 1000; the default) prefixes.
</li><li class="listitem">
<code class="literal">--biggest-first</code>, to sort packages in decreasing size order, rather
  than in increasing size order.
</li></ul></div><p><strong>Note. </strong>The collected filesystem size data is only meaningful after a complete
clean rebuild. Be sure to run <code class="literal">make clean all</code> before using <code class="literal">make
graph-size</code>.</p><p>To compare the root filesystem size of two different Buildroot compilations,
for example after adjusting the configuration or when switching to another
Buildroot release, use the <code class="literal">size-stats-compare</code> script. It takes two
<code class="literal">file-size-stats.csv</code> files (produced by <code class="literal">make graph-size</code>) as input.
Refer to the help text of this script for more details:</p><pre class="screen">utils/size-stats-compare -h</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="top-level-parallel-build"></a>8.12. Top-level parallel build</h2></div></div></div><p><strong>Note. </strong>This section deals with a very experimental feature, which is known to
break even in some non-unusual situations. Use at your own risk.</p><p>Buildroot has always been capable of using parallel build on a per
package basis: each package is built by Buildroot using <code class="literal">make -jN</code> (or
the equivalent invocation for non-make-based build systems). The level
of parallelism is by default number of CPUs + 1, but it can be
adjusted using the <code class="literal">BR2_JLEVEL</code> configuration option.</p><p>Until 2020.02, Buildroot was however building packages in a serial
fashion: each package was built one after the other, without
parallelization of the build between packages. As of 2020.02,
Buildroot has experimental support for <span class="strong"><strong>top-level parallel build</strong></span>,
which allows some signicant build time savings by building packages
that have no dependency relationship in parallel. This feature is
however marked as experimental and is known not to work in some cases.</p><p>In order to use top-level parallel build, one must:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Enable the option <code class="literal">BR2_PER_PACKAGE_DIRECTORIES</code> in the Buildroot
configuration
</li><li class="listitem">
Use <code class="literal">make -jN</code> when starting the Buildroot build
</li></ol></div><p>Internally, the <code class="literal">BR2_PER_PACKAGE_DIRECTORIES</code> will enable a mechanism
called <span class="strong"><strong>per-package directories</strong></span>, which will have the following
effects:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Instead of a global <span class="emphasis"><em>target</em></span> directory and a global <span class="emphasis"><em>host</em></span> directory
  common to all packages, per-package <span class="emphasis"><em>target</em></span> and <span class="emphasis"><em>host</em></span> directories
  will be used, in <code class="literal">$(O)/per-package/&lt;pkg&gt;/target/</code> and
  <code class="literal">$(O)/per-package/&lt;pkg&gt;/host/</code> respectively. Those folders will be
  populated from the corresponding folders of the package dependencies
  at the beginning of <code class="literal">&lt;pkg&gt;</code> build. The compiler and all other tools
  will therefore only be able to see and access files installed by
  dependencies explicitly listed by <code class="literal">&lt;pkg&gt;</code>.
</li><li class="listitem">
At the end of the build, the global <span class="emphasis"><em>target</em></span> and <span class="emphasis"><em>host</em></span> directories
  will be populated, located in <code class="literal">$(O)/target</code> and <code class="literal">$(O)/host</code>
  respectively. This means that during the build, those folders will
  be empty and it’s only at the very end of the build that they will
  be populated.
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_integration_with_eclipse"></a>8.13. Integration with Eclipse</h2></div></div></div><p>While a part of the embedded Linux developers like classical text
editors like Vim or Emacs, and command-line based interfaces, a number
of other embedded Linux developers like richer graphical interfaces to
do their development work. Eclipse being one of the most popular
Integrated Development Environment, Buildroot integrates with Eclipse
in order to ease the development work of Eclipse users.</p><p>Our integration with Eclipse simplifies the compilation, remote
execution and remote debugging of applications and libraries that are
built on top of a Buildroot system. It does not integrate the
Buildroot configuration and build processes themselves with
Eclipse. Therefore, the typical usage model of our Eclipse integration
would be:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
Configure your Buildroot system with <code class="literal">make menuconfig</code>, <code class="literal">make
  xconfig</code> or any other configuration interface provided with
  Buildroot.
</li><li class="listitem">
Build your Buildroot system by running <code class="literal">make</code>.
</li><li class="listitem">
Start Eclipse to develop, execute and debug your own custom
  applications and libraries, that will rely on the libraries built
  and installed by Buildroot.
</li></ul></div><p>The Buildroot Eclipse integration installation process and usage is
described in detail at
<a class="ulink" href="https://github.com/mbats/eclipse-buildroot-bundle/wiki" target="_top">https://github.com/mbats/eclipse-buildroot-bundle/wiki</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="_advanced_usage"></a>8.14. Advanced usage</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_using_the_generated_toolchain_outside_buildroot"></a>8.14.1. Using the generated toolchain outside Buildroot</h3></div></div></div><p>You may want to compile, for your target, your own programs or other
software that are not packaged in Buildroot. In order to do this you
can use the toolchain that was generated by Buildroot.</p><p>The toolchain generated by Buildroot is located by default in
<code class="literal">output/host/</code>. The simplest way to use it is to add
<code class="literal">output/host/bin/</code> to your PATH environment variable and then to
use <code class="literal">ARCH-linux-gcc</code>, <code class="literal">ARCH-linux-objdump</code>, <code class="literal">ARCH-linux-ld</code>, etc.</p><p>Alternatively, Buildroot can also export the toolchain and the development
files of all selected packages, as an SDK, by running the command
<code class="literal">make sdk</code>. This generates a tarball of the content of the host directory
<code class="literal">output/host/</code>, named <code class="literal">&lt;TARGET-TUPLE&gt;_sdk-buildroot.tar.gz</code> (which can be
overriden by setting the environment variable <code class="literal">BR2_SDK_PREFIX</code>) and
located in the output directory <code class="literal">output/images/</code>.</p><p>This tarball can then be distributed to application developers, when
they want to develop their applications that are not (yet) packaged as
a Buildroot package.</p><p>Upon extracting the SDK tarball, the user must run the script
<code class="literal">relocate-sdk.sh</code> (located at the top directory of the SDK), to make
sure all paths are updated with the new location.</p><p>Alternatively, if you just want to prepare the SDK without generating
the tarball (e.g. because you will just be moving the <code class="literal">host</code> directory,
or will be generating the tarball on your own), Buildroot also allows
you to just prepare the SDK with <code class="literal">make prepare-sdk</code> without actually
generating a tarball.</p><p>For your convenience, by selecting the option
<code class="literal">BR2_PACKAGE_HOST_ENVIRONMENT_SETUP</code>, you can get a
<code class="literal">environment-setup</code> script installed in <code class="literal">output/host/</code> and therefore
in your SDK.  This script can be sourced with
<code class="literal">. your/sdk/path/environment-setup</code> to export a number of environment
variables that will help cross-compile your projects using the
Buildroot SDK: the <code class="literal">PATH</code> will contain the SDK binaries, standard
<span class="emphasis"><em>autotools</em></span> variables will be defined with the appropriate values, and
<code class="literal">CONFIGURE_FLAGS</code> will contain basic <code class="literal">./configure</code> options to
cross-compile <span class="emphasis"><em>autotools</em></span> projects. It also provides some useful
commands. Note however that once this script is sourced, the
environment is setup only for cross-compilation, and no longer for
native compilation.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_using_literal_gdb_literal_in_buildroot"></a>8.14.2. Using <code class="literal">gdb</code> in Buildroot</h3></div></div></div><p>Buildroot allows to do cross-debugging, where the debugger runs on the
build machine and communicates with <code class="literal">gdbserver</code> on the target to
control the execution of the program.</p><p>To achieve this:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
If you are using an <span class="emphasis"><em>internal toolchain</em></span> (built by Buildroot), you
  must enable <code class="literal">BR2_PACKAGE_HOST_GDB</code>, <code class="literal">BR2_PACKAGE_GDB</code> and
  <code class="literal">BR2_PACKAGE_GDB_SERVER</code>. This ensures that both the cross gdb and
  gdbserver get built, and that gdbserver gets installed to your target.
</li><li class="listitem">
If you are using an <span class="emphasis"><em>external toolchain</em></span>, you should enable
  <code class="literal">BR2_TOOLCHAIN_EXTERNAL_GDB_SERVER_COPY</code>, which will copy the
  gdbserver included with the external toolchain to the target. If your
  external toolchain does not have a cross gdb or gdbserver, it is also
  possible to let Buildroot build them, by enabling the same options as
  for the <span class="emphasis"><em>internal toolchain backend</em></span>.
</li></ul></div><p>Now, to start debugging a program called <code class="literal">foo</code>, you should run on the
target:</p><pre class="screen">gdbserver :2345 foo</pre><p>This will cause <code class="literal">gdbserver</code> to listen on TCP port 2345 for a connection
from the cross gdb.</p><p>Then, on the host, you should start the cross gdb using the following
command line:</p><pre class="screen">&lt;buildroot&gt;/output/host/bin/&lt;tuple&gt;-gdb -ix &lt;buildroot&gt;/output/staging/usr/share/buildroot/gdbinit foo</pre><p>Of course, <code class="literal">foo</code> must be available in the current directory, built
with debugging symbols. Typically you start this command from the
directory where <code class="literal">foo</code> is built (and not from <code class="literal">output/target/</code> as the
binaries in that directory are stripped).</p><p>The <code class="literal">&lt;buildroot&gt;/output/staging/usr/share/buildroot/gdbinit</code> file will tell the
cross gdb where to find the libraries of the target.</p><p>Finally, to connect to the target from the cross gdb:</p><pre class="screen">(gdb) target remote &lt;target ip address&gt;:2345</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="ccache"></a>8.14.3. Using <code class="literal">ccache</code> in Buildroot</h3></div></div></div><p><a class="ulink" href="http://ccache.samba.org" target="_top">ccache</a> is a compiler cache. It stores the
object files resulting from each compilation process, and is able to
skip future compilation of the same source file (with same compiler
and same arguments) by using the pre-existing object files. When doing
almost identical builds from scratch a number of times, it can nicely
speed up the build process.</p><p><code class="literal">ccache</code> support is integrated in Buildroot. You just have to enable
<code class="literal">Enable compiler cache</code> in <code class="literal">Build options</code>. This will automatically
build <code class="literal">ccache</code> and use it for every host and target compilation.</p><p>The cache is located in <code class="literal">$HOME/.buildroot-ccache</code>. It is stored
outside of Buildroot output directory so that it can be shared by
separate Buildroot builds. If you want to get rid of the cache, simply
remove this directory.</p><p>You can get statistics on the cache (its size, number of hits,
misses, etc.) by running <code class="literal">make ccache-stats</code>.</p><p>The make target <code class="literal">ccache-options</code> and the <code class="literal">CCACHE_OPTIONS</code> variable
provide more generic access to the ccache. For example</p><pre class="screen"># set cache limit size
make CCACHE_OPTIONS="--max-size=5G" ccache-options

# zero statistics counters
make CCACHE_OPTIONS="--zero-stats" ccache-options</pre><p><code class="literal">ccache</code> makes a hash of the source files and of the compiler options.
If a compiler option is different, the cached object file will not be
used. Many compiler options, however, contain an absolute path to the
staging directory. Because of this, building in a different output
directory would lead to many cache misses.</p><p>To avoid this issue, buildroot has the <code class="literal">Use relative paths</code> option
(<code class="literal">BR2_CCACHE_USE_BASEDIR</code>). This will rewrite all absolute paths that
point inside the output directory into relative paths. Thus, changing
the output directory no longer leads to cache misses.</p><p>A disadvantage of the relative paths is that they also end up to be
relative paths in the object file. Therefore, for example, the debugger
will no longer find the file, unless you cd to the output directory
first.</p><p>See <a class="ulink" href="https://ccache.samba.org/manual.html#_compiling_in_different_directories" target="_top">the
ccache manual’s section on "Compiling in different directories"</a> for
more details about this rewriting of absolute paths.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="download-location"></a>8.14.4. Location of downloaded packages</h3></div></div></div><p>The various tarballs that are downloaded by Buildroot are all stored
in <code class="literal">BR2_DL_DIR</code>, which by default is the <code class="literal">dl</code> directory. If you want
to keep a complete version of Buildroot which is known to be working
with the associated tarballs, you can make a copy of this directory.
This will allow you to regenerate the toolchain and the target
filesystem with exactly the same versions.</p><p>If you maintain several Buildroot trees, it might be better to have a
shared download location. This can be achieved by pointing the
<code class="literal">BR2_DL_DIR</code> environment variable to a directory. If this is
set, then the value of <code class="literal">BR2_DL_DIR</code> in the Buildroot configuration is
overridden. The following line should be added to <code class="literal">&lt;~/.bashrc&gt;</code>.</p><pre class="screen"> export BR2_DL_DIR=&lt;shared download location&gt;</pre><p>The download location can also be set in the <code class="literal">.config</code> file, with the
<code class="literal">BR2_DL_DIR</code> option. Unlike most options in the .config file, this value
is overridden by the <code class="literal">BR2_DL_DIR</code> environment variable.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="pkg-build-steps"></a>8.14.5. Package-specific <span class="emphasis"><em>make</em></span> targets</h3></div></div></div><p>Running <code class="literal">make &lt;package&gt;</code> builds and installs that particular package
and its dependencies.</p><p>For packages relying on the Buildroot infrastructure, there are
numerous special make targets that can be called independently like
this:</p><pre class="screen">make &lt;package&gt;-&lt;target&gt;</pre><p>The package build targets are (in the order they are executed):</p><div class="informaltable"><table class="informaltable" cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; " width="90%"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"> command/target    </th><th style="border-bottom: 1px solid #527bbd; " align="left" valign="top"> Description</th></tr></thead><tbody><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">source</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Fetch the source (download the tarball, clone
the source repository, etc)</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">depends</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Build and install all dependencies required to
build the package</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">extract</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Put the source in the package build directory
(extract the tarball, copy the source, etc)</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">patch</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Apply the patches, if any</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">configure</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Run the configure commands, if any</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">build</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Run the compilation commands</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">install-staging</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="strong"><strong>target package:</strong></span> Run the installation of the package in the
staging directory, if necessary</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">install-target</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p><span class="strong"><strong>target package:</strong></span> Run the installation of the package in the
target directory, if necessary</p></td></tr><tr><td style="border-right: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">install</code></p></td><td style="" align="left" valign="top"><p><span class="strong"><strong>target package:</strong></span> Run the 2 previous installation commands</p>
<p><span class="strong"><strong>host package:</strong></span> Run the installation of the package in the host
directory</p></td></tr></tbody></table></div><p>Additionally, there are some other useful make targets:</p><div class="informaltable"><table class="informaltable" cellpadding="4px" style="border-collapse: collapse;border-top: 3px solid #527bbd; border-bottom: 3px solid #527bbd; border-left: 3px solid #527bbd; border-right: 3px solid #527bbd; " width="90%"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"> command/target    </th><th style="border-bottom: 1px solid #527bbd; " align="left" valign="top"> Description</th></tr></thead><tbody><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">show-depends</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Displays the first-order dependencies required to build the
package</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">show-recursive-depends</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Recursively displays the dependencies
  required to build the package</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">show-rdepends</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Displays the first-order reverse dependencies of
  the package (i.e packages that directly depend on it)</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">show-recursive-rdepends</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Recursively displays the reverse
  dependencies of the package (i.e the packages that depend on it,
  directly or indirectly)</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">graph-depends</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Generate a dependency graph of the package, in the
context of the current Buildroot configuration. See
<a class="link" href="ch08.html#graph-depends">this section</a> for more details about dependency
graphs.</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">graph-rdepends</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Generate a graph of this package reverse
  dependencies (i.e the packages that depend on it, directly or
  indirectly)</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">dirclean</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Remove the whole package build directory</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">reinstall</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Re-run the install commands</p></td></tr><tr><td style="border-right: 1px solid #527bbd; border-bottom: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">rebuild</code></p></td><td style="border-bottom: 1px solid #527bbd; " align="left" valign="top"><p>Re-run the compilation commands - this only makes
sense when using the <code class="literal">OVERRIDE_SRCDIR</code> feature or when you modified a file
directly in the build directory</p></td></tr><tr><td style="border-right: 1px solid #527bbd; " align="center" valign="top"><p><code class="literal">reconfigure</code></p></td><td style="" align="left" valign="top"><p>Re-run the configure commands, then rebuild - this only
makes sense when using the <code class="literal">OVERRIDE_SRCDIR</code> feature or when you modified a
file directly in the build directory</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_using_buildroot_during_development"></a>8.14.6. Using Buildroot during development</h3></div></div></div><p>The normal operation of Buildroot is to download a tarball, extract
it, configure, compile and install the software component found inside
this tarball. The source code is extracted in
<code class="literal">output/build/&lt;package&gt;-&lt;version&gt;</code>, which is a temporary directory:
whenever <code class="literal">make clean</code> is used, this directory is entirely removed, and
re-created at the next <code class="literal">make</code> invocation. Even when a Git or
Subversion repository is used as the input for the package source
code, Buildroot creates a tarball out of it, and then behaves as it
normally does with tarballs.</p><p>This behavior is well-suited when Buildroot is used mainly as an
integration tool, to build and integrate all the components of an
embedded Linux system. However, if one uses Buildroot during the
development of certain components of the system, this behavior is not
very convenient: one would instead like to make a small change to the
source code of one package, and be able to quickly rebuild the system
with Buildroot.</p><p>Making changes directly in <code class="literal">output/build/&lt;package&gt;-&lt;version&gt;</code> is not
an appropriate solution, because this directory is removed on <code class="literal">make
clean</code>.</p><p>Therefore, Buildroot provides a specific mechanism for this use case:
the <code class="literal">&lt;pkg&gt;_OVERRIDE_SRCDIR</code> mechanism. Buildroot reads an <span class="emphasis"><em>override</em></span>
file, which allows the user to tell Buildroot the location of the
source for certain packages.</p><p>The default location of the override file is <code class="literal">$(CONFIG_DIR)/local.mk</code>,
as defined by the <code class="literal">BR2_PACKAGE_OVERRIDE_FILE</code> configuration option.
<code class="literal">$(CONFIG_DIR)</code> is the location of the Buildroot <code class="literal">.config</code> file, so
<code class="literal">local.mk</code> by default lives side-by-side with the <code class="literal">.config</code> file,
which means:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
In the top-level Buildroot source directory for in-tree builds
  (i.e., when <code class="literal">O=</code> is not used)
</li><li class="listitem">
In the out-of-tree directory for out-of-tree builds (i.e., when
  <code class="literal">O=</code> is used)
</li></ul></div><p>If a different location than these defaults is required, it can be
specified through the <code class="literal">BR2_PACKAGE_OVERRIDE_FILE</code> configuration
option.</p><p>In this <span class="emphasis"><em>override</em></span> file, Buildroot expects to find lines of the form:</p><pre class="screen">&lt;pkg1&gt;_OVERRIDE_SRCDIR = /path/to/pkg1/sources
&lt;pkg2&gt;_OVERRIDE_SRCDIR = /path/to/pkg2/sources</pre><p>For example:</p><pre class="screen">LINUX_OVERRIDE_SRCDIR = /home/bob/linux/
BUSYBOX_OVERRIDE_SRCDIR = /home/bob/busybox/</pre><p>When Buildroot finds that for a given package, an
<code class="literal">&lt;pkg&gt;_OVERRIDE_SRCDIR</code> has been defined, it will no longer attempt to
download, extract and patch the package. Instead, it will directly use
the source code available in the specified directory and <code class="literal">make clean</code>
will not touch this directory. This allows to point Buildroot to your
own directories, that can be managed by Git, Subversion, or any other
version control system. To achieve this, Buildroot will use <span class="emphasis"><em>rsync</em></span> to
copy the source code of the component from the specified
<code class="literal">&lt;pkg&gt;_OVERRIDE_SRCDIR</code> to <code class="literal">output/build/&lt;package&gt;-custom/</code>.</p><p>This mechanism is best used in conjunction with the <code class="literal">make
&lt;pkg&gt;-rebuild</code> and <code class="literal">make &lt;pkg&gt;-reconfigure</code> targets. A <code class="literal">make
&lt;pkg&gt;-rebuild all</code> sequence will <span class="emphasis"><em>rsync</em></span> the source code from
<code class="literal">&lt;pkg&gt;_OVERRIDE_SRCDIR</code> to <code class="literal">output/build/&lt;package&gt;-custom</code> (thanks to
<span class="emphasis"><em>rsync</em></span>, only the modified files are copied), and restart the build
process of just this package.</p><p>In the example of the <code class="literal">linux</code> package above, the developer can then
make a source code change in <code class="literal">/home/bob/linux</code> and then run:</p><pre class="screen">make linux-rebuild all</pre><p>and in a matter of seconds gets the updated Linux kernel image in
<code class="literal">output/images</code>. Similarly, a change can be made to the BusyBox source
code in <code class="literal">/home/bob/busybox</code>, and after:</p><pre class="screen">make busybox-rebuild all</pre><p>the root filesystem image in <code class="literal">output/images</code> contains the updated
BusyBox.</p><p>Source trees for big projects often contain hundreds or thousands of
files which are not needed for building, but will slow down the process
of copying the sources with <span class="emphasis"><em>rsync</em></span>. Optionally, it is possible define
<code class="literal">&lt;pkg&gt;_OVERRIDE_SRCDIR_RSYNC_EXCLUSIONS</code> to skip syncing certain files
from the source tree. For example, when working on the <code class="literal">webkitgtk</code>
package, the following will exclude the tests and in-tree builds from
a local WebKit source tree:</p><pre class="screen">WEBKITGTK_OVERRIDE_SRCDIR = /home/bob/WebKit
WEBKITGTK_OVERRIDE_SRCDIR_RSYNC_EXCLUSIONS = \
        --exclude JSTests --exclude ManualTests --exclude PerformanceTests \
        --exclude WebDriverTests --exclude WebKitBuild --exclude WebKitLibraries \
        --exclude WebKit.xcworkspace --exclude Websites --exclude Examples</pre><p>By default, Buildroot skips syncing of VCS artifacts (e.g., the <span class="strong"><strong>.git</strong></span> and
<span class="strong"><strong>.svn</strong></span> directories). Some packages prefer to have these VCS directories
available during build, for example for automatically determining a precise
commit reference for version information. To undo this built-in filtering at a
cost of a slower speed, add these directories back:</p><pre class="screen">LINUX_OVERRIDE_SRCDIR_RSYNC_EXCLUSIONS = --include .git</pre></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch07.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="pt02.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch09.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>