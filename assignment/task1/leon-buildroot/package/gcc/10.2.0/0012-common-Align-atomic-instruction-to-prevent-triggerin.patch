From 85033cd4b13c5a25a316a4f1c8b18155c09f8d57 Mon Sep 17 00:00:00 2001
From: Daniel Cederman <cederman@gaisler.com>
Date: Mon, 11 Dec 2017 16:13:50 +0100
Subject: [PATCH 12/50] common: Align atomic instruction to prevent triggering
 TN-0011 errata

---
 libstdc++-v3/config/cpu/sparc/atomicity.h | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/libstdc++-v3/config/cpu/sparc/atomicity.h b/libstdc++-v3/config/cpu/sparc/atomicity.h
index f782705dda6..368a9c28666 100644
--- a/libstdc++-v3/config/cpu/sparc/atomicity.h
+++ b/libstdc++-v3/config/cpu/sparc/atomicity.h
@@ -82,8 +82,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION
   __exchange_and_add(volatile _Atomic_word* __mem, int __val) throw ()
   {
     _Atomic_word __result, __tmp;
-
-    __asm__ __volatile__("1:	ldstub	[%1], %0\n\t"
+    __asm__ __volatile__(".align 16\n\t"
+			 "1:	ldstub	[%1], %0\n\t"
 			 "	cmp	%0, 0\n\t"
 			 "	bne	1b\n\t"
 			 "	 nop"
@@ -104,8 +104,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION
   __atomic_add(volatile _Atomic_word* __mem, int __val) throw ()
   {
     _Atomic_word __tmp;
-
-    __asm__ __volatile__("1:	ldstub	[%1], %0\n\t"
+    __asm__ __volatile__(".align 16\n\t"
+			 "1:	ldstub	[%1], %0\n\t"
 			 "	cmp	%0, 0\n\t"
 			 "	bne	1b\n\t"
 			 "	 nop"
-- 
2.34.1

